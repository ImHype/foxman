#!/usr/bin/env node
'use strict';
require('colors');
var util = require('../dist/helper/util').default;
var path = require('path');
var pkg = require('../package.json');
var config;
var argv = require('yargs')
    .usage('Usage: foxman [options]')
    .alias('C', 'config')
    .alias('C', 'c')
    .describe('C', '配置文件路径')
    .default('C', 'foxman.config.js')

    .alias('P', 'proxy')
    .alias('P', 'p')
    .describe('P', '使用配置中的代理，填写代理名即可')
    .default('P', false)

    .alias('U', 'update')
    .alias('U', 'u')
    .describe('U', '是否远程nei中拉取接口信息')
    .default('U', false)

    .alias('V', 'version')
    .alias('V', 'v')
    .describe('V', 'Show version')
    .version(() => `v${pkg.version}`)

    .help('H')
    .alias('H', 'help')
    .alias('H', 'h')

    .example('foxman -C ./config.json -P local -U')
    .argv;

var configPath = path.join(process.cwd(), argv.config);

try {
    config = require(configPath);
} catch (err) {
    if (err.code === 'MODULE_NOT_FOUND') {
        if (~err.toString().indexOf(configPath)) {
            util.error(`config file not found!`);
        } else {
            util.error(`${err.replace(/Error: /i, '')}\n${'[T]'.blue} Try npm install or check The ${argv.config}！`);
        }
    } else {
        util.error(err);
    }
}

require('../app.js')(Object.assign({}, config, {argv}));